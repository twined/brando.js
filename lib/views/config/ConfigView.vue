<template lang="html">
  <div class="dashboard">
    <transition name="fade">
      <div
        id="content"
        class="container">
        <div class="text-center">
          <svg
            class="w-25"
            xmlns="http://www.w3.org/2000/svg"
            viewBox="30 0 240 240">
            <path d="M54 164h192c2.2 0 4-1.8 4-4s-1.8-4-4-4H54c-2.2 0-4 1.8-4 4s1.8 4 4 4z"/>
            <path d="M30.1 160.9l10.6 45.8c1 4.6 4.7 8.1 9.3 9V228c0 6.6 5.4 12 12 12h32c6.6 0 12-5.4 12-12v-12h84v12c0 6.6 5.4 12 12 12h32c6.6 0 12-5.4 12-12v-12h1.6c5.6 0 10.5-3.8 11.7-9.3l10.6-45.8c.2-1 .1-2-.4-2.9l-27.6-47.3L227 10.2C226.1 4.4 221 0 215.1 0H81.2c-6.2 0-11.3 4.6-12 10.7l-11.1 100L30.5 158c-.5.9-.6 1.9-.4 2.9zM98 228c0 2.2-1.8 4-4 4H62c-2.2 0-4-1.8-4-4v-12h40v12zm140 0c0 2.2-1.8 4-4 4h-32c-2.2 0-4-1.8-4-4v-12h40v12zM77.2 11.6c.2-2 1.9-3.6 4-3.6h133.9c2 0 3.7 1.5 4 3.4l14.3 96.6H66.5l10.7-96.4zM64.3 116h171.4l26 44.6-10.2 44.3c-.4 1.8-2 3.1-3.9 3.1H52.4c-1.9 0-3.5-1.3-3.9-3.1l-10.2-44.3 26-44.6z"/>
            <path d="M88.6 56.5C93.2 61.3 99.4 64 106 64s12.8-2.7 17.4-7.5c.1-.1.2-.2.3-.4 8.8-9.6 8.4-24.4-1-33.4s-24.1-9.1-33.5 0-9.7 23.9-1 33.4l.4.4zm7.9-3.7c2.2-3 5.8-4.8 9.5-4.8s7.3 1.8 9.5 4.8c-5.6 4.3-13.4 4.3-19 0zM106 24c8.8 0 16 7.2 16 16 0 2.2-.5 4.4-1.4 6.4-2.8-3.1-6.5-5.2-10.6-6V36c0-2.2-1.8-4-4-4s-4 1.8-4 4v4.5c-4.1.8-7.8 2.9-10.6 6-.9-2-1.4-4.2-1.4-6.5 0-8.8 7.2-16 16-16zM168.6 56.5c4.5 4.8 10.8 7.5 17.4 7.5s12.8-2.7 17.4-7.5c.1-.1.2-.2.3-.4 8.8-9.6 8.4-24.4-1-33.4-9.3-9.1-24.1-9.1-33.5 0-9.3 9.1-9.7 23.9-1 33.4l.4.4zm7.9-3.7c2.2-3 5.8-4.8 9.5-4.8s7.3 1.8 9.5 4.8c-5.6 4.3-13.4 4.3-19 0zM186 24c8.8 0 16 7.2 16 16 0 2.2-.5 4.4-1.4 6.4-2.8-3.1-6.5-5.2-10.6-6V36c0-2.2-1.8-4-4-4s-4 1.8-4 4v4.5c-4.1.8-7.8 2.9-10.6 6-.9-2-1.4-4.2-1.4-6.5 0-8.8 7.2-16 16-16zM86 84c1.1 0 2.1-.4 2.8-1.2C89.6 82 90 81 90 80c0-1.1-.4-2.1-1.2-2.8-.2-.2-.4-.3-.6-.5-.2-.2-.5-.3-.7-.4-.2-.1-.5-.2-.7-.2-.8-.2-1.6-.1-2.3.2-.5.2-.9.5-1.3.8-.8.8-1.2 1.8-1.2 2.9 0 1.1.4 2.1 1.2 2.8.7.8 1.7 1.2 2.8 1.2zM86 100c1.1 0 2.1-.4 2.8-1.2C89.6 98 90 97 90 96c0-1.1-.4-2.1-1.2-2.8-.2-.2-.4-.3-.6-.5-.2-.2-.5-.3-.7-.4-.2-.1-.5-.2-.7-.2-.8-.2-1.6-.1-2.3.2-.5.2-.9.5-1.3.8-.8.8-1.2 1.8-1.2 2.9 0 1.1.4 2.1 1.2 2.8.7.8 1.7 1.2 2.8 1.2zM104.2 76.7c-.2-.2-.5-.3-.7-.4-.2-.1-.5-.2-.7-.2-.8-.2-1.6-.1-2.3.2-.5.2-.9.5-1.3.8-.8.8-1.2 1.8-1.2 2.9 0 1.1.4 2.1 1.2 2.8.7.8 1.8 1.2 2.8 1.2s2.1-.4 2.8-1.2c.8-.8 1.2-1.8 1.2-2.8 0-1.1-.4-2.1-1.2-2.8-.2-.2-.4-.4-.6-.5zM104.2 92.7c-.2-.2-.5-.3-.7-.4-.2-.1-.5-.2-.7-.2-.8-.2-1.6-.1-2.3.2-.5.2-.9.5-1.3.8-.8.8-1.2 1.8-1.2 2.9 0 1.1.4 2.1 1.2 2.8.7.8 1.8 1.2 2.8 1.2s2.1-.4 2.8-1.2c.8-.8 1.2-1.8 1.2-2.8 0-1.1-.4-2.1-1.2-2.8-.2-.2-.4-.4-.6-.5zM120.2 76.7c-.2-.2-.5-.3-.7-.4-.2-.1-.5-.2-.7-.2-.8-.2-1.6-.1-2.3.2-.5.2-.9.5-1.3.8-.7.8-1.1 1.8-1.2 2.8 0 1.1.4 2.1 1.2 2.8.7.8 1.8 1.2 2.8 1.2s2.1-.4 2.8-1.2c.8-.7 1.2-1.7 1.2-2.7 0-1.1-.4-2.1-1.2-2.8-.2-.2-.4-.4-.6-.5zM120.2 92.7c-.2-.2-.5-.3-.7-.4-.2-.1-.5-.2-.7-.2-.8-.2-1.6-.1-2.3.2-.5.2-.9.5-1.3.8-.7.8-1.1 1.8-1.2 2.8 0 1.1.4 2.1 1.2 2.8.7.8 1.8 1.2 2.8 1.2s2.1-.4 2.8-1.2c.8-.7 1.2-1.7 1.2-2.7 0-1.1-.4-2.1-1.2-2.8-.2-.2-.4-.4-.6-.5zM131.2 82.8c.7.8 1.8 1.2 2.8 1.2s2.1-.4 2.8-1.2c.8-.8 1.2-1.8 1.2-2.8 0-1.1-.4-2.1-1.2-2.8-.2-.2-.4-.3-.6-.5-.2-.2-.5-.3-.7-.4-.2-.1-.5-.2-.7-.2-.8-.2-1.6-.1-2.3.2-.5.2-.9.5-1.3.8-.7.8-1.1 1.8-1.2 2.8 0 1.2.4 2.2 1.2 2.9zM136.2 92.7c-.2-.2-.5-.3-.7-.4-.2-.1-.5-.2-.7-.2-.8-.2-1.6-.1-2.3.2-.5.2-.9.5-1.3.8-.7.8-1.1 1.8-1.2 2.8 0 1.1.4 2.1 1.2 2.8.7.8 1.8 1.2 2.8 1.2s2.1-.4 2.8-1.2c.8-.7 1.2-1.7 1.2-2.7 0-1.1-.4-2.1-1.2-2.8-.2-.2-.4-.4-.6-.5zM162 84h52c2.2 0 4-1.8 4-4s-1.8-4-4-4h-52c-2.2 0-4 1.8-4 4s1.8 4 4 4zM162 100h32c2.2 0 4-1.8 4-4s-1.8-4-4-4h-32c-2.2 0-4 1.8-4 4s1.8 4 4 4zM86 148c6.6 0 12-5.4 12-12s-5.4-12-12-12-12 5.4-12 12 5.4 12 12 12zm0-16c2.2 0 4 1.8 4 4s-1.8 4-4 4-4-1.8-4-4 1.8-4 4-4zM126 148c6.6 0 12-5.4 12-12s-5.4-12-12-12-12 5.4-12 12 5.4 12 12 12zm0-16c2.2 0 4 1.8 4 4s-1.8 4-4 4-4-1.8-4-4 1.8-4 4-4zM166 148c6.6 0 12-5.4 12-12s-5.4-12-12-12-12 5.4-12 12 5.4 12 12 12zm0-16c2.2 0 4 1.8 4 4s-1.8 4-4 4-4-1.8-4-4 1.8-4 4-4zM206 148c6.6 0 12-5.4 12-12s-5.4-12-12-12-12 5.4-12 12 5.4 12 12 12zm0-16c2.2 0 4 1.8 4 4s-1.8 4-4 4-4-1.8-4-4 1.8-4 4-4z"/>
          </svg>
          <h2 class="lead mt-5 text-upper text-strong">Konfigurasjon</h2>
          <hr class="my-4">
          <div
            v-if="cfg">
            <div
              v-for="(c, key) in cfg"
              :key="key">
              <template v-if="c.type === 'string'">
                <KInput
                  v-model="c.value"
                  :value="c.value"
                  :has-error="errors.has('c[value]')"
                  :error-text="errors.first('c[value]')"
                  :label="c.description"
                  name="c[value]"
                  placeholder=""
                  data-vv-name="c[value]"
                  data-vv-value-path="innerValue"
                />
              </template>
            </div>
            <div>
              <button
                class="btn btn-primary"
                @click="store">
                Lagre konfigurasjon
              </button>
            </div>
          </div>
        </div>
      </div>
    </transition>
  </div>
</template>

<script>
import { clone } from '../../utils'

export default {
  data () {
    return {
      cfg: null
    }
  },

  inject: [
    'adminChannel'
  ],

  created () {
    this.adminChannel.channel
      .push('config:get')
      .receive('ok', payload => {
        this.cfg = clone(payload.cfg)
      })
  },

  methods: {
    store () {
      this.adminChannel.channel
        .push('config:set', { cfg: this.cfg })
        .receive('ok', payload => {
          this.$toast.success({ message: 'Konfigurasjon oppdatert' })
        })
    }
  }
}
</script>
